<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>MVP Collector - Análise de Pele</title>
</head>
<body>
    <div class="container">
        <h1>MVP Collector: Análise de Pele e UV</h1>
        <div id="status" class="status success">{{ status_message }}</div>
        
        <button onclick="detectLocation()">1. Detectar Localização</button>
        <p id="location"></p>
        
        <form id="uploadForm">
            <input type="file" id="photo" name="photo" accept="image/*" required>
            <button type="button" onclick="uploadPhoto()">2. Carregar Foto</button>
        </form>
        <p id="uploadStatus"></p>
        
        <button onclick="analyze()">3. Analisar (UV + Tipo de Pele)</button>
        <div id="analysisResults"></div>
        
        <button onclick="getRecommendations()">4. Obter Recomendações</button>
        <ul id="recommendations"></ul>
        
        <button onclick="exportCSV()">Exportar Logs (CSV)</button>
    </div>

    <script>
        function detectLocation() {
            fetch('/detect_location').then(res => res.json()).then(data => {
                document.getElementById('status').innerHTML = `<strong>${data.message}</strong>`;
                document.getElementById('status').className = `status ${data.status}`;
                if (data.status === 'success') {
                    document.getElementById('location').innerHTML = `Localização: ${data.location}`;
                }
            });
        }
        function uploadPhoto() {
            const formData = new FormData();
            formData.append('photo', document.getElementById('photo').files[0]);
            fetch('/upload', { method: 'POST', body: formData }).then(res => res.json()).then(data => {
                document.getElementById('uploadStatus').innerHTML = `<strong>${data.message}</strong>`;
                document.getElementById('uploadStatus').className = `status ${data.status}`;
            });
        }
        function analyze() {
            fetch('/analyze', { method: 'POST' }).then(res => res.json()).then(data => {
                document.getElementById('status').innerHTML = `<strong>${data.message}</strong>`;
                document.getElementById('status').className = `status ${data.status}`;
                if (data.status === 'success') {
                    document.getElementById('analysisResults').innerHTML = `UV Index: ${data.uv_index}<br>Tipo de Pele: ${data.skin_type}`;
                }
            });
        }
        function getRecommendations() {
            fetch('/recommend').then(res => res.json()).then(data => {
                document.getElementById('status').innerHTML = `<strong>${data.message}</strong>`;
                document.getElementById('status').className = `status ${data.status}`;
                if (data.status === 'success') {
                    const recList = document.getElementById('recommendations');
                    recList.innerHTML = '';
                    data.recommendations.forEach(rec => {
                        const li = document.createElement('li');
                        li.textContent = rec;
                        recList.appendChild(li);
                    });
                }
            });
        }
        function exportCSV() {
            window.location.href = '/export';
        }
    </script>
    <style>
        body { font-family: Arial; margin: 20px; background: #f4f4f4; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        button { background: #007BFF; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer; margin: 5px 0; }
        button:hover { background: #0056b3; }
        #status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        form { margin: 20px 0; }
        input[type="file"] { margin: 10px 0; }
        ul { list-style-type: disc; padding-left: 20px; }
    </style>
</body>
</html>